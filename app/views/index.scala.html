@(title: String)

<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>@title</title>

        <link rel="stylesheet" href="@routes.Assets.at("css/style.css")">
        <link rel="stylesheet" href="@routes.Assets.at("css/redmond/jquery-ui.css")">
        <link rel="stylesheet" href="@routes.Assets.at("css/redmond/jquery.ui.theme.css")">
        <link rel="stylesheet" href="@routes.Assets.at("css/jqgrid/ui.jqgrid.css")">

        <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.1/jquery.min.js" type="text/javascript"></script>
        <script src="http://www.trirand.com/blog/jqgrid/js/jquery.jqGrid.min.js" type="text/javascript"></script>
        <script type="text/javascript" src="@routes.Application.javascriptRoutes"></script>

        <script>
            var lastServerSel = -1;
            var lastVhostSel = -1;
            var serverName;
            $(document).ready(function() {
                $(serverTable).jqGrid({
                    url: "@routes.Application.servers",
                    datatype: "json",
                    height: 'auto',
                    colNames:['Name','Description'],
                    colModel:[
                        {name:'name',index:'name', width:100},
                        {name:'descr',index:'descr', width:280}
                    ],
                    viewrecords: true,
                    loadonce: true,
                    caption: "Servers",
                    onSelectRow: function(id){
                        if(id && id!==lastServerSel){
                           $(this).restoreRow(lastServerSel);
                           lastServerSel=id;
                           serverName = $(this).getRowData(lastServerSel)['name'];
                           jsRoutes.controllers.Application.serverDetail(serverName).ajax({
                                success: function(data) {
                                    $("#serverDetail").html(data);
                                    lastVhostSel = -1;
                                    $("#vhostDetail").empty()
                                    jsRoutes.controllers.Application.vhosts(serverName).ajax({
                                        success: function(gridData) {
                                            reloadGrid("#vhostTable", gridData);
                                            $("#vhosts").show()
                                        },
                                        error: showServerError
                                    });
                                },
                                error: showServerError
                           });
                        }
                    }
                });
                $("#reloadBtn").click(function(){
                    $.get("@routes.Application.reload()", "",
                        function (gridData){
                            reloadGrid("#serverTable", gridData);
                            $("#serverDetail").empty()
                            $("#vhosts").hide()
                            lastServerSel = -1;
                        }
                    ).fail(showServerError);
                });
                $("#vhostTable").jqGrid({
                    datatype: "local",
                    height: 'auto',
                    colNames:['Name','Description'],
                    colModel:[
                        {name:'name',index:'name', width:100},
                        {name:'descr',index:'descr', width:280}
                    ],
                    viewrecords: true,
                    loadonce: true,
                    caption: "Virtual Hosts",
                    onSelectRow: function(id){
                        if(id && id!==lastVhostSel){
                           $(this).restoreRow(lastVhostSel);
                           lastVhostSel=id;
                           var vhostName = $(this).getRowData(lastVhostSel)['name'];
                           jsRoutes.controllers.Application.vhostDetail(serverName, vhostName).ajax({
                                success: function(data) {
                                    $("#vhostDetail").html(data);
                                },
                                error: showVhostError
                           });
                        }
                    }
                });
                $("#vhosts").hide()
            });

            function showServerError(errorData){
                $("#vhosts").hide()
                $("#serverDetail").html(errorData.responseText);
            }
            function showVhostError(errorData){
                $("#vhostDetail").html(errorData.responseText);
            }
            function reloadGrid(gridId, gridData){
              $(gridId).jqGrid('clearGridData');
              $(gridId).jqGrid('setGridParam', {data: gridData}).trigger('reloadGrid');
            }
        </script>
    </head>
    <body>
        <header>@title</header>
        <section>
            <div id="servers">
            <table>
                <tr>
                    <td style="vertical-align: top">
                        <div>
                            <table id="serverTable"></table>
                            <button id="reloadBtn">Reload</button>
                        </div>
                    </td>
                    <td style="vertical-align: top">
                        <div id="serverDetail"></div>
                    </td>
                </tr>
            </table>
            </div>
            <div id="vhosts">
                <table>
                    <tr>
                        <td style="vertical-align: top">
                            <div>
                                <table id="vhostTable"></table>
                            </div>
                        </td>
                        <td style="vertical-align: top">
                            <div id="vhostDetail"></div>
                        </td>
                    </tr>
                </table>
            </div>
        </section>
    </body>
</html>